# Namaz Vakitleri (Flutter)

Prayer times app built with Flutter, Clean Architecture, Bloc, and BDD testing (flutter_gherkin + Maestro).

## Prerequisites

- Flutter SDK (stable) in PATH
- Android Studio / Xcode for platform builds

## Immediate setup (run first)

The native Android/iOS wrappers must be generated by Flutter. **Run these in order:**

1. **Regenerate native scaffolding** (in this folder):

   ```bash
   flutter create . --org com.namazvakitleri.family --project-name namaz_vakitleri_flutter
   flutter pub get
   ```

2. **Add permissions** (PowerShell):

   ```powershell
   .\scripts\add_permissions_after_flutter_create.ps1
   ```

   Or add them manually per [docs/IMPLEMENTATION_STEPS.md](docs/IMPLEMENTATION_STEPS.md) (Step 3).

3. **Smoke test and run:**

   ```bash
   flutter test
   flutter run
   ```

## Assets

- `assets/images/` – qibla_compass.png, qibla_needle.png (placeholders copied from RN icon; replace with real art).
- `assets/audio/` – adhan_fajr.mp3 (copied from RN `assets/sounds/adhan.mp3`).
- `assets/translations/` – optional ARB/JSON for i18n.

## Tests

- **All tests (recommended):**  
  `.\scripts\run_all_tests.ps1` – runs unit + E2E, saves logs, screenshots, recordings to `test_results/<timestamp>/`

- **Unit / widget / logic (no emulator):**  
  `flutter test`

- **Tier 1 – Prayer math (Diyanet accuracy):**  
  `flutter test test/prayer_math_test.dart`  
  Istanbul and London Fajr/Maghrib within 1 min of reference. For reference match, run with `TZ=Europe/Istanbul` or `TZ=Europe/London` (or from Turkey/UK).

- **Tier 2 – Golden (visual regression):**  
  First run: `flutter test test/golden/ --update-goldens` to generate goldens.  
  Then: `flutter test test/golden/` for regression. Validates 32px corners and Lucide icons.

- **Tier 3 – E2E (Maestro):**  
  `maestro test .maestro/smoke_test_flutter.yaml` (smoke)  
  `maestro test .maestro/production_check.yaml` (full flow: onboarding → Utrecht → Settings → Dini Günler)  
  Run from this directory after installing the app (`appId: com.namazvakitleri.family`).

## Project structure

- `lib/core/` – theme, routes, DI, constants
- `lib/domain/` – entities, repositories (abstract), use cases
- `lib/data/` – datasources, repository implementations
- `lib/features/` – Blocs and UI per feature (location, settings, prayer_times, notifications, prayer_log, zikirmatik, home, about)
- `test/` – unit and widget tests
- `test_driver/features/` – Gherkin feature files for flutter_gherkin (logic/state)

## Logging (Talker)

In debug/profile builds the app is wrapped with **TalkerWrapper**. Use the Talker UI (floating button or shake) to view logs and export/share for diagnosis. All navigation, API (city search), and notification triggers are logged via `AppLogger` (see [lib/core/utils/app_logger.dart](lib/core/utils/app_logger.dart)).

## CI/CD

Codemagic: run `flutter test`, then build Android/iOS. Optionally run Maestro for platform E2E.
