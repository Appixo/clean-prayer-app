appId: com.namazvakitleri.family
---
# Maestro Smoke Test - Fresh Install Experience
# Uses Deep Linking to bypass Expo Development Client server selection screen
#
# PREREQUISITES:
# 1. Android emulator or physical device must be running and connected
# 2. Metro bundler MUST be running and ready (npx expo start)
#    - Wait until you see "Metro waiting on..." before running test
#    - CRITICAL: Wait 10-15 seconds after Metro starts before running test
# 3. App must be installed on the device (fresh build recommended)
# 4. Before running test, manually clear app data:
#    adb shell pm clear com.namazvakitleri.family
#
# DEEP LINKING: This test uses a deep link URL to bypass the Expo Dev Client
# server selection screen and connect directly to Metro bundler.

# ============================================
# PHASE 1: Launch App via Deep Link
# ============================================
# Launch App via Deep Link (Force connect to Metro)
- launchApp:
    clearState: true
    arguments: 
      url: "exp+namaz-vakitleri-family://expo-development-client/?url=http%3A%2F%2F10.0.2.2%3A8081"

# ============================================
# PHASE 2: Handle Expo Lobby (Server Selection Screen)
# ============================================
# If deep link fails and we land on the server list, tap the server manually.
# We use simple text matching to avoid Regex/YAML syntax errors.
- runFlow:
    when:
      visible: 
        text: "10.0.2.2"
        index: 0
    commands:
      - tapOn: 
          text: "10.0.2.2"
          index: 0
      - waitForAnimationToEnd
      - waitForAnimationToEnd

# ============================================
# PHASE 3: Handle Permission Popups
# ============================================
# Sometimes "Allow Notifications?" or location permission pops up immediately and blocks the view.
- runFlow:
    when:
      visible: 
        text: ".*Allow|İzin Ver|Izin.*"
        index: 0
    commands:
      - tapOn: 
          text: ".*Allow|İzin Ver|Izin.*"
      - waitForAnimationToEnd

# ============================================
# PHASE 4: Wait for Metro Compilation (CRITICAL)
# ============================================
# THE MAGIC FIX: WAIT FOR COMPILATION
# We wait up to 60 seconds for the 'Get Started' button.
# This covers the time it takes for Metro to build the app on Windows.
- extendedWaitUntil:
    visible: ".*Başla|Get Started|Start Setup.*"
    timeout: 60000

# Additional waits for app initialization
- waitForAnimationToEnd
- waitForAnimationToEnd
- waitForAnimationToEnd

# ---------------------------------------------------------
# APP IS NOW FULLY LOADED - BEGIN TEST
# ---------------------------------------------------------

# ============================================
# PHASE 5: Welcome Screen
# ============================================
- assertVisible: ".*Namaz Vakitleri|Prayer.*"
- tapOn: ".*Başla|Get Started|Start Setup.*"
- waitForAnimationToEnd
- waitForAnimationToEnd

# ============================================
# PHASE 6: Language Selection
# ============================================
- assertVisible: ".*Türkçe|English.*"
- tapOn: "Türkçe"
- waitForAnimationToEnd
- tapOn: ".*Devam Et|Continue.*"
- waitForAnimationToEnd
- waitForAnimationToEnd

# ============================================
# PHASE 7: Location Setup
# ============================================
- extendedWaitUntil:
    visible: ".*Konumunuz|Konumumu Bul|Şehir Ara.*"
    timeout: 10000

- assertVisible: "Konumunuz"
- waitForAnimationToEnd

# Tap "Şehir Ara" to open city search
- tapOn: ".*Şehir Ara.*"
- waitForAnimationToEnd

# City Search Modal
- assertVisible: "Şehir Arayın"
- inputText: "Utrecht"

# Wait for search results to debounce/load
- waitForAnimationToEnd
- waitForAnimationToEnd

# Try to tap "Utrecht, Hollanda" if it appears, otherwise tap first "Utrecht" result
- runFlow:
    when:
      visible: "Utrecht, Hollanda"
    commands:
      - tapOn: "Utrecht, Hollanda"
      - waitForAnimationToEnd

# Fallback: Tap first Utrecht result
- tapOn: 
    text: "Utrecht"
    index: 0
    optional: true

- waitForAnimationToEnd
- waitForAnimationToEnd

# ============================================
# PHASE 8: Onboarding Completion
# ============================================
# View Mode Selection
- assertVisible: "Deneyim Seviyesi"
- tapOn: "Basit"
- waitForAnimationToEnd
- tapOn: ".*Devam Et.*"
- waitForAnimationToEnd

# Notification Settings
- assertVisible: "Bildirimler"
- tapOn: ".*Devam Et.*"
- waitForAnimationToEnd

# Adhan Settings
- assertVisible: "Ezan Sesi"
- tapOn: ".*Tamamla|Complete|Kurulumu Tamamla.*"
- waitForAnimationToEnd
- waitForAnimationToEnd

# Success Screen
- assertVisible: "Hazırsınız!"
- tapOn: ".*Uygulamayı Kullanmaya Başla|Uygulamaya Git.*"
- waitForAnimationToEnd
- waitForAnimationToEnd
- waitForAnimationToEnd

# ============================================
# PHASE 9: Home Screen Verification
# ============================================
# Verify the app successfully completed onboarding and shows home screen
- extendedWaitUntil:
    visible: "UTRECHT"
    timeout: 10000

- assertVisible: "UTRECHT"

# Verify all 5 main prayer times are displayed
# (İmsak = Fajr, Öğle = Dhuhr, İkindi = Asr, Akşam = Maghrib, Yatsı = Isha)
- assertVisible: "İmsak"
- assertVisible: "Öğle"
- assertVisible: "İkindi"
- assertVisible: "Akşam"
- assertVisible: "Yatsı"

# Optional: Verify sunrise is also shown (6th time)
- assertVisible: "Güneş"

# ============================================
# PHASE 10: Navigate to Settings and About
# ============================================
# Open Settings tab (Ayarlar)
- tapOn:
    text: "Ayarlar"
    index: 0
- waitForAnimationToEnd
- waitForAnimationToEnd

# Wait for Settings screen and tap Hakkında (About)
- extendedWaitUntil:
    visible: ".*Hakkında|About.*"
    timeout: 8000
- tapOn: ".*Hakkında|About.*"
- waitForAnimationToEnd

# Verify About screen loaded
- extendedWaitUntil:
    visible: ".*Clean Prayer|version|Gizlilik|Privacy.*"
    timeout: 8000
- assertVisible: ".*Clean Prayer|version|Gizlilik|Privacy.*"
