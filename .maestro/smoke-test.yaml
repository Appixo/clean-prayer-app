# Maestro Smoke Test (spec: launch, permission, home, settings/about)
# Same flow as smoke_test.yaml. Covers:
# - App Launch (via deep link)
# - System Location Permission dialog (Maestro handles natively / runFlow when Allow visible)
# - Home Screen verification
# - Navigate to Settings -> About and verify About screen
#
# Run: maestro test .maestro/smoke-test.yaml
# Prerequisites: Android emulator/device, Metro running, app installed, app data cleared.

appId: com.namazvakitleri.family
---
- launchApp:
    clearState: true
    arguments:
      url: "exp+namaz-vakitleri-family://expo-development-client/?url=http%3A%2F%2F10.0.2.2%3A8081"

- runFlow:
    when:
      visible: { text: "10.0.2.2", index: 0 }
    commands:
      - tapOn: { text: "10.0.2.2", index: 0 }
      - waitForAnimationToEnd

- runFlow:
    when:
      visible: { text: ".*Allow|İzin Ver|Izin.*", index: 0 }
    commands:
      - tapOn: { text: ".*Allow|İzin Ver|Izin.*" }
      - waitForAnimationToEnd

- extendedWaitUntil:
    visible: ".*Başla|Get Started|Start Setup.*"
    timeout: 60000
- waitForAnimationToEnd
- waitForAnimationToEnd

- assertVisible: ".*Namaz Vakitleri|Prayer.*"
- tapOn: ".*Başla|Get Started|Start Setup.*"
- waitForAnimationToEnd
- assertVisible: ".*Türkçe|English.*"
- tapOn: "Türkçe"
- waitForAnimationToEnd
- tapOn: ".*Devam Et|Continue.*"
- waitForAnimationToEnd

- extendedWaitUntil:
    visible: ".*Konumunuz|Konumumu Bul|Şehir Ara.*"
    timeout: 10000
- tapOn: ".*Şehir Ara.*"
- waitForAnimationToEnd
- assertVisible: "Şehir Arayın"
- inputText: "Utrecht"
- waitForAnimationToEnd
- waitForAnimationToEnd
- runFlow:
    when:
      visible: "Utrecht, Hollanda"
    commands:
      - tapOn: "Utrecht, Hollanda"
      - waitForAnimationToEnd
- tapOn: { text: "Utrecht", index: 0, optional: true }
- waitForAnimationToEnd

- assertVisible: "Deneyim Seviyesi"
- tapOn: "Basit"
- waitForAnimationToEnd
- tapOn: ".*Devam Et.*"
- waitForAnimationToEnd
- assertVisible: "Bildirimler"
- tapOn: ".*Devam Et.*"
- waitForAnimationToEnd
- assertVisible: "Ezan Sesi"
- tapOn: ".*Tamamla|Complete|Kurulumu Tamamla.*"
- waitForAnimationToEnd
- assertVisible: "Hazırsınız!"
- tapOn: ".*Uygulamayı Kullanmaya Başla|Uygulamaya Git.*"
- waitForAnimationToEnd
- waitForAnimationToEnd

# Home Screen verification
- extendedWaitUntil:
    visible: "UTRECHT"
    timeout: 10000
- assertVisible: "UTRECHT"
- assertVisible: "İmsak"
- assertVisible: "Öğle"

# Navigate to Settings then About
- tapOn: { text: "Ayarlar", index: 0 }
- waitForAnimationToEnd
- extendedWaitUntil:
    visible: ".*Hakkında|About.*"
    timeout: 8000
- tapOn: ".*Hakkında|About.*"
- waitForAnimationToEnd
- extendedWaitUntil:
    visible: ".*Clean Prayer|version|Gizlilik|Privacy.*"
    timeout: 8000
- assertVisible: ".*Clean Prayer|version|Gizlilik|Privacy.*"
